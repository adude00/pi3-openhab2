rule "Cloud Connector restart"
  when
    Item cl_restart received command
  then
    logInfo("Maintenance","OpenHAB Cloud Connector restart requested, proceeding...")
    executeCommandLine(Duration.ofSeconds(10), "/openhab/runtime/bin/client", "-p", "habopen", "bundle:restart", "org.openhab.io.openhabcloud")
end

rule "OpenHAB restart"
  when
    Item sw_restart received command
  then
    logInfo("Maintenance","OpenHAB restart requested, proceeding...")
    executeCommandLine(Duration.ofSeconds(10), "ssh", "root@127.0.0.1", "touch /tmp/restart-oh-requested")
    executeCommandLine(Duration.ofSeconds(10), "ssh", "root@127.0.0.1", "service", "docker-compose@openhab5", "restart")
end

rule "PI restart"
  when
    Item pi_restart received command
  then
    logInfo("Maintenance","PI reboot requested, proceeding...")
    executeCommandLine(Duration.ofSeconds(10), "ssh", "root@127.0.0.1", "touch /tmp/restart-pi5-requested")
    executeCommandLine(Duration.ofSeconds(10), "ssh", "root@127.0.0.1", "reboot")
end

rule "Service Restart"
  when
    Item service_restart received command
  then
    logInfo("Maintenance","Requested restart of service " + service_name.state + ", proceeding...")
    executeCommandLine(Duration.ofSeconds(10), "ssh", "root@127.0.0.1", "echo ", service_name.state.toString, "> /tmp/service-restart")
    executeCommandLine(Duration.ofSeconds(120), "ssh", "root@127.0.0.1", "systemctl", "restart", service_name.state.toString)
end

