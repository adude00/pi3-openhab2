
rule "Termostato lento"
  when
    Time cron "0 0/30 * * * ?"
    //Item avgSoggiornoAvg changed
  then
    var Number acPower = acPSoggiorno.state as DecimalType
    var Number cur_temp = avgSoggiornoAvg.state
    var Number tolSogg = hsSoggiorno.state
    var Number setpoint = spSoggiorno.state
   
    if (tsSoggiorno.state == ON && tsSoggiornoType.state == 2) { 
      logInfo("tsSoggiornoSlow","tsSoggiornoSlow: INFO: cur_temp: (" + cur_temp + "), setpoint: (" + setpoint + "), tolSogg: (" + tolSogg + "), acPower: " + acPower)

      if ( ( cur_temp + tolSogg )  < setpoint ) {
        // TOO COLD: INCREASE by ONE
        acPower = acPower + 1
        acPSoggiorno.sendCommand(acPower)
        logInfo("tsSoggiornoSlow","tsSoggiornoSlow: COLD! cur_temp: (" + cur_temp + ") lower than setpoint (" + setpoint + "). Increasing acPower to " + acPower)
      }
    
      if ( ( cur_temp - tolSogg ) > setpoint ) {
        if ( acPower > 0 ) {
          // TOO HOT: DECREASE by ONE
          acPower = acPower - 1
          acPSoggiorno.sendCommand(acPower)
          logInfo("tsSoggiornoSlow","tsSoggiornoSlow: HOT! cur_temp: (" + cur_temp + ") higher than setpoint (" + setpoint + "). Decreasing acPower to " + acPower)
        }
      }

    // END IF termostato ON and type=2
  }

end

rule "Termostato Lento Traduzione"
  when 
    Item acPSoggiorno received command
  then
    var Number cdzTemp

    if (tsSoggiorno.state == ON && tsSoggiornoType.state == 2) {
      switch(receivedCommand.toString) {
        case "0": { cdzTemp = 10.0 }
        case "1": { cdzTemp = 17.0 }
        case "2": { cdzTemp = 18.0 }
        case "3": { cdzTemp = 19.0 }
        case "4": { cdzTemp = 20.0 }
        case "5": { cdzTemp = 21.0 }
        case "6": { cdzTemp = 23.0 }
        case "7": { cdzTemp = 30.0 }
        case "8": { cdzTemp = 31.0 }
        }

      logInfo("tsSoggiornoSlowTrad","tsSoggiornoSlowTrad: INFO: acPSoggiorno: " + receivedCommand + ", cdzTemp: " + cdzTemp)
      Air_Conditioner_Temperature.sendCommand(cdzTemp)
    }

end


