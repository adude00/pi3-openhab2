rule "Lavoro"
when
    Item Scene_Lavoro changed to ON
then
  pushNotification("Scena: LAVORO", "La scena LAVORO è stata attivata")
  logInfo("Scene","Scena LAVORO: iniziata")

  gTappDog.sendCommand(DOWN)

  createTimer(now.plusSeconds(30), [|
    gScene.sendCommand(OFF)
    logInfo("Scene","Scena LAVORO: finita")
    ])
end

rule "A Casa"
when
    Item Scene_aCasa changed to ON
then
  pushNotification("Scena: A CASA", "La scena A CASA è stata attivata")
  logInfo("Scene","Scena A CASA: iniziata")

  gTappProd.sendCommand(UP)
  IPCams.sendCommand(OFF)

  createTimer(now.plusSeconds(30), [|
    AutoRientro.sendCommand(OFF) 
    gScene.sendCommand(OFF)
    logInfo("Scene","Scena A CASA: finita")
    ])
end

rule "Mattina"
when
    Item Scene_Mattina changed to ON
then
  pushNotification("Scena: MATTINA", "La scena MATTINA è stata attivata")
  logInfo("Scene","Scena MATTINA: iniziata")

  gTappProd.sendCommand(UP)
  IPCams.sendCommand(OFF)
  tsBagno.sendCommand(ON)
  tsCameretta.sendCommand(OFF)
  sf04_Light.sendCommand(ON)
  Air_Conditioner_Temperature.sendCommand(23.0)

  createTimer(now.plusSeconds(30), [|
    AutoRientro.sendCommand(OFF) 
    gScene.sendCommand(OFF)
    logInfo("Scene","Scena MATTINA: finita")
    ])
end

rule "Usciamo"
when
    Item Scene_Usciamo changed to ON
then
  pushNotification("Scena: USCIAMO", "La scena USCIAMO è stata attivata")
  logInfo("Scene","Scena USCIAMO: iniziata")

  gTappProd.sendCommand(DOWN)
  gLuci.sendCommand(OFF)

  createTimer(now.plusSeconds(30), [|
    IPCams.sendCommand(ON)
    gScene.sendCommand(OFF)
    logInfo("Scene","Scena USCIAMO: Telecamere accese e scena finita")
    ])
  createTimer(now.plusSeconds(300), [|
    AutoRientro.sendCommand(ON)
    ])
end


rule "Privacy "
when
    Item Scene_Privacy changed to ON
then
    logInfo("Scene","Scena PRIVACY: iniziata")
    gTappLvrm.sendCommand(DOWN)
    createTimer(now.plusSeconds(30), [|
      gScene.sendCommand(OFF)
      logInfo("Scene","Scena PRIVACY: finita")
    ])
end

rule "Chiudi tutto"
when
    Item Scene_Chiudi changed to ON
then
    logInfo("Scene","Scena CHIUDI: iniziata")
    gTappProd.sendCommand(DOWN)
    createTimer(now.plusSeconds(30), [|
      gScene.sendCommand(OFF)
      logInfo("Scene","Scena CHIUDI: finita")
    ])
end

rule "Vado a Letto"
when
    Item Scene_aLetto changed to ON
then
    logInfo("Scene","Scena A Letto: iniziata")
    
    createTimer(now.plusSeconds(1),  [ |
      gTappProd.sendCommand(DOWN)
      logInfo("Scene","Scena A Letto: tapparelle abbassate")
    ])

    createTimer(now.plusSeconds(3),  [ |
      if (tsSoggiorno.state == ON) {
        tsSoggiorno.sendCommand(OFF)
      }
      logInfo("Scene","Scena A Letto: termostato spento")
    ])

    createTimer(now.plusSeconds(5),  [ |
      sf04_Light.sendCommand(OFF)
      sf03_Light.sendCommand(OFF)
      led02_Power.sendCommand(OFF)
      logInfo("Scene","Scena A Letto: luci soggiorno spente")
    ])

    createTimer(now.plusSeconds(7),  [ |
      gCinema.sendCommand(OFF)
      logInfo("Scene","Scena A Letto: gruppo gCinema spento")
    ])

    createTimer(now.plusSeconds(30), [|
      gScene.sendCommand(OFF)
      logInfo("Scene","Scena A Letto: finita")
    ])

    //createTimer(now.plusSeconds(3600), [|
    //  gLuci.sendCommand(OFF)
    //  logInfo("Scene","Scena A Letto: spente le luci")
    //])
end


rule "Sole"
when
    Item Scene_Sole changed to ON
then
    logInfo("Scene","Scena SOLE: iniziata")
    Tapp01.sendCommand(DOWN)
    createTimer(now.plusSeconds(22), [|
      Tapp01.sendCommand(STOP)
      gScene.sendCommand(OFF)
      logInfo("Scene","Scena SOLE: finita")
    ])
end

