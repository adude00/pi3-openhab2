import java.text.DecimalFormat

// https://community.openhab.org/t/how-do-i-get-the-average-out-of-2-items-in-rules-file/41387/2
rule mediaSogg
when
  Item Casa_Temperature_Sogg_Down changed or
  Item sf06_Temp changed or
  Item sf04_Temp changed
then
  var avgTemp = (sf06_Temp.state as DecimalType + bs13_temperature.state as DecimalType + bs11_temperature.state as DecimalType) / 3
  Casa_Temperature_AVG.postUpdate(avgTemp)
end


rule "Media 30m"
  when
    Item Casa_Temperature_AVG changed
  then

    var Number avgOrig = Casa_Temperature_AVG.averageSince(now.minusMinutes(30))
    val DecimalFormat df = new DecimalFormat("#.#")
    val Number avgRound = Double::valueOf(df.format(avgOrig.doubleValue))

    //avgSoggiornoAvg.postUpdate(Casa_Temperature_AVG.averageSince(now.minusMinutes(30)))
    avgSoggiornoAvg.postUpdate(avgRound)
end
