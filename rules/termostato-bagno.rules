rule "Termostato Bagno"
  when
    Item spBagno changed or
    Item sf07_Temp changed or
    Item tsBagno received command
  then
  
  var Number cur_temp = sf07_Temp.state 
  var Number setpoint = spBagno.state 
  var Number hysteresis = hsBagno.state 
 
  logInfo("tsBagno","DEBUG Stufetta: Valuto la regola")
  if (tsBagno.state == ON) {
    logInfo("tsBagno","DEBUG Stufetta: tsBagno.state == ON")
    logInfo("tsBagno","DEBUG Stufetta: cur_temp: " + (cur_temp).floatValue + ", setpoint: " + ((setpoint).floatValue + ", hysteresis: " + (hysteresis).floatValue) + " fine")
    if ((cur_temp).floatValue < ((setpoint).floatValue - (hysteresis).floatValue)) {
      logInfo("tsBagno","DEBUG Stufetta: entro in (cur_temp).floatValue < ((setpoint).floatValue - (hysteresis).floatValue)")
      if (sf07_Light.state == OFF) {
        logInfo("tsBagno","DEBUG Stufetta: entro in sf07_Light == OFF")
        sendCommand(sf07_Light, ON)
        logInfo("tsBagno","Stufetta: accesa")
      }
    }
    else {
      logInfo("tsBagno","DEBUG Stufetta: temperatura - isteresi raggiunta")
      sendCommand(sf07_Light, OFF)
      logInfo("tsBagno","Stufetta: spenta")
    }
  }
end
